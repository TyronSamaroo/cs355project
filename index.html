<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="author" content="Tyron Samaroo" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="index.js" defer></script>
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>Project</title>
</head>

<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">Internet and Web Tech</a>
            </div>
            <div>
                <ul class="nav navbar-nav">
                    <li class="active"><a href="index.html">Home</a></li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Browser
              <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="browser.html#Navigator">Navigator</a></li>
                            <li><a href="browser.html#Window">Window</a></li>
                            <li><a href="browser.html#Screen">Screen</a></li>
                            <li><a href="browser.html#Location">Location</a></li>
                            <li><a href="browser.html#Geolocation">Geolocation</a></li>
                        </ul>
                    </li>

                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Course
              <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://www.zybooks.com" target="_blank">Zybook</a></li>
                            <li><a href="https://tophat.com/" target="_blank">TopHat</a></li>
                            <li><a href="https://tinyurl.com/CSCI355-Fall2019" target="_blank">Course Google Drive</a></li>
                            <li><a href="https://www.w3schools.com/" target="_blank">W3Schools</a></li>
                        </ul>

                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">About
              <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="aboutme.html">Developer</a></li>
                            <li><a href="contact.html">Contact Us</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
<!-- 
    <form action="Test1.asp">
        <input type="button" value="Upload" onclick="clickUpload();" />
        <input type="button" value="Download" onclick="clickDownload();" />
        <form id="UploadForm" action="test3.asp" enctype="multipart/form-data">
            <input type="file" id="UploadFile" onchange="MakeUpload();" style="display:all" />
        </form>
        <form id="DownloadForm" action="Test4.asp">
        </form>
    </form> -->
    

    
    <div style="text-align: center;padding: 20%"> 
           
        
            <h1 id="searchtitle">SEARCH HERE</h1>
            <form id="search-param" class="input-group">
                <input class="form-control" id="searchfield" type="text" placeholder="Search..">
                <span class="input-group-btn"><input class ="btn btn-primary" type="submit" value="Submit"></span>

            </form> 
            <hr>
            <div class="input-group">
                <h4>ONLY JSON XML CSV ALLOWED</h4>
                <span>
                    <input type="file" id="uploadedFile" name="uploadedFile" accept=".json,.xml,.csv" >
                    <br>
                    <button  class="input-group" onclick="displayUploadedFile()">Click To Display Uploaded File Results</button>
                </span>
            </div>
            
            
            <hr>

            <h2 id="searchtitle">RESULTS</h2>
            <div class="btn-group" role="group" aria-label="...">
                    <button type="button" class="btn btn-default" onclick="displayUploadedFile()">JSON</button>
                    <button type="button" class="btn btn-default" onclick="uploadedFileToXML()">XML</button>
                    <button type="button" class="btn btn-default" onclick="UploadedFileToCSV()">CSV</button>
            </div>
            <input type="checkbox" onClick="toggle(this)" />
            
            <hr>
            <div id="output">

            </div>
    </div>
    

    </div>
    <script>
    // Uploaded Functions
    function displayUploadedFile () {
            var file = document.getElementById ("uploadedFile");
            console.log(file.value.split('.')[1]);
            if(file.value.split('.')[1] == 'json'){
                console.log("JSON FILE")
                displayJSON(file)
            }
            if(file.value.split('.')[1] == 'xml'){
                console.log("XML FILE")
                displayXML(file)
            }
            if(file.value.split('.')[1] == 'csv'){
                console.log("CSV FILE")
                displayCSV(file) 
            }
            
    }

    function displayJSON(file){
        
        var filename = file.files.item(0).name;
        let url =`${filename}`;
        console.log("URL" + url)
        fetch(url)
            .then(res => res.json())
            .then(data => {
                console.log(data.Result)
                // data.items.forEach(search =>{ })
                let output = ''
                count = 0;
                data.Result.forEach(search =>{
                    output += `
                            <div id= "displayedresults">
                            
                            <input id= "check${count}" type="checkbox" name="searchfiles" value=searchfiles onclick="isSelected()">
                            <hr> 
                            <div class= "list-group mb-4"> 
                                <li class="list-group-item list-group-item-info"> ${search.title} </li>
                                
                                <a class="list-group-item list-group-item-sucess" href="${search.url}" target="_blank">${search.url}</a>
                                <li class="list-group-item list-group-item-warning"> ${search.description} </li>
                              
                            </div>`
                            count++;
                        })
                    
                document.getElementById('output').innerHTML = output;
            })
        
    }

    function displayXML(file){
        var filename = file.files.item(0).name;
        let url =`${filename}`;
        console.log("URL" + url)
        fetch(url)
            .then(res => res.text())
            .then(data => {
                console.log(data)
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(data,"text/xml");
                console.log(xmlDoc)
                let length = xmlDoc.getElementsByTagName("result").length;
                let output = ``;
                for(let i =0; i < length; i++){
                    output += `
                    <div id= "displayedresults">
                            
                            <input id= "check${i}" type="checkbox" name="searchfiles" value=searchfiles onclick="isSelected()">
                            <hr> 
                            <div class= "list-group mb-4"> 
                                <li class="list-group-item list-group-item-info"> ${xmlDoc.getElementsByTagName("title")[i].childNodes[0].nodeValue} </li>
                                
                                <a class="list-group-item list-group-item-sucess" href="${xmlDoc.getElementsByTagName("url")[i].childNodes[0].nodeValue}" target="_blank">${xmlDoc.getElementsByTagName("url")[i].childNodes[0].nodeValue}</a>
                                <li class="list-group-item list-group-item-warning"> ${xmlDoc.getElementsByTagName("description")[i].childNodes[0].nodeValue} </li>
                              
                            </div>`
                }
                document.getElementById('output').innerHTML = output;


            })

    }
    function displayCSV(file){
        var filename = file.files.item(0).name;
        let url =`${filename}`;
        console.log("URL" + url)
        fetch(url)
            .then(res => res.text())
            .then(data => {
                console.log(data)
                let lines = data.split('\n');
                console.log(lines)
                output = '';
                for( let i=0;i < lines.length - 1; i++){
                    let results = lines[i].split(',');
                    output += `
                    <div id= "displayedresults">
                            
                            <input id= "check${i}" type="checkbox" name="searchfiles" value=searchfiles onclick="isSelected()">
                            <hr> 
                            <div class= "list-group mb-4"> 
                                <li class="list-group-item list-group-item-info"> ${results[0]} </li>
                                
                                <a class="list-group-item list-group-item-sucess" href="${results[1]}" target="_blank">${results[1]}</a>
                                <li class="list-group-item list-group-item-warning"> ${results[2]} </li>
                              
                            </div>`    
                }
               
            
                
                document.getElementById('output').innerHTML = output;


            })

    }
    
    
    </script>
          
   <script>
       function displayFile(){
           
           var file = document.getElementById('myFile');
           console.log(file.files.item(0).name);
           var filename = file.files.item(0).name;
           let url =`${filename}`;
           fetch(url)
           .then(res => res.json())
           .then(data =>{
               console.log(data);

               let parser = new DOMParser();
               let xml = parser.parseFromString(data,"application/xml");
               //document.getElementById('output').textContent = data;
               console.log(xml)
               results(xml);
           });
           output = `
            <a href="${file.files.item(0).name}" target="_blank">${file.files.item(0).name}</a>
            <p> \ </p>
           `
           document.getElementById('output').innerHTML = output;
       }
       function results(xml){
           let title = document.getElementById('title');
           let url = document.getElementById('url');
           let discription = document.getElementById('discription');
           //console.log(title.firstChild.nodeValue);
       }
       
   
   </script>
    
    
    
    <script>
        document.getElementById('search-param').addEventListener('submit',getResults);
      
        function getResults(e){
            e.preventDefault();
            let q = document.getElementById('searchfield').value;
            output = ``;
            fetch(`https://www.googleapis.com/customsearch/v1?cx=005328335594563973105:loxqirrkk08&key=AIzaSyCQ2Wnm30rrgRQ1Zknyk1XGAYljRYlo6do&q=${q}`)
                .then((res) =>res.json())
                .then((data) => {
                    console.log(data.items);
                    count = 0;
                    data.items.forEach(search =>{
                        
                        output += `
                        <div id= "displayedresults">
                            
                            <input id= "check${count}" type="checkbox" name="searchfiles" value=searchfiles onclick="isSelected()">
                            <hr>   
                            <div class= "list-group mb-4"> 
                                <li class="list-group-item list-group-item-info"> ${search.title} </li>
                                
                                <a class="list-group-item list-group-item-sucess" href="${search.link}" target="_blank">${search.htmlFormattedUrl}</a>
                                <li class="list-group-item list-group-item-warning"> ${search.snippet} </li>
                              
                            </div>
                        </div>
                        `;
                        count++;
                    })
                    document.getElementById('output').innerHTML = output;
                })
        
        }

        
        function AllSelected(){
            convertFileTo();
        }
        function toggle(source) {
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i] != source)
                     checkboxes[i].checked = source.checked;
              }
        }

        // function convertToJson();
        // function covertToXML();
        // function converToCSV();


        
        
    </script>


    <script>
        
    </script>
</body>

</html>